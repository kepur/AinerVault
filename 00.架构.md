## ç¬¬ä¸€é˜¶æ®µ
FastAPIï¼ˆæ‰€æœ‰åç«¯æ¨¡å—ï¼‰
PostgreSQL + pgvector
Redis
RabbitMQ
MinIOï¼ˆæˆ– S3ï¼‰
Nginx
Prometheus + Grafana
ï¼ˆæ—¥å¿—å…ˆ stdout + æ–‡ä»¶ï¼Œåé¢å†æ¥ Loki/ELKï¼‰

### æ¶æ„åˆ†å±‚
1.Experience Layerï¼ˆä½“éªŒå±‚ï¼‰
- ainern2d-studio-web (Vue3)
2.Control Layerï¼ˆæ§åˆ¶/ç¼–æ’å±‚ï¼‰
- gatewayï¼ˆAPI å…¥å£ï¼‰
- orchestratorï¼ˆçŠ¶æ€æœº / DAGï¼‰
- worker-hubï¼ˆæ‰§è¡Œæ§åˆ¶é¢ï¼‰
3.Intelligence Layerï¼ˆæ™ºèƒ½å†³ç­–å±‚ï¼‰
- entity-core
- asset-knowledge
- planner
- model-router
4.Execution Layerï¼ˆæ‰§è¡Œå±‚ï¼‰
- worker-video
- worker-audio
- worker-llm
- worker-lipsync
- composer
5.Data & Knowledge Layerï¼ˆæ•°æ®ä¸çŸ¥è¯†å±‚ï¼‰
- PostgreSQLï¼ˆä¸šåŠ¡æ•°æ®ï¼‰
- pgvectorï¼ˆå‘é‡æ£€ç´¢ï¼‰
- Redisï¼ˆç¼“å­˜/çŸ­çŠ¶æ€ï¼‰
- RabbitMQï¼ˆé˜Ÿåˆ—/äº‹ä»¶ï¼‰
- MinIO/S3ï¼ˆäº§ç‰©ä¸ç´ æï¼‰
6.Platform Layerï¼ˆå¹³å°åŸºç¡€è®¾æ–½å±‚ï¼‰
- Docker / Docker Composeï¼ˆå½“å‰ï¼‰
- Nginx / Traefik
- Prometheus / Grafana / Loki / Tempoï¼ˆåç»­ï¼‰
- CI/CDï¼ˆGitHub Actions / GitLab CIï¼‰
- æœºæˆ¿/äº‘èµ„æºã€GPU èŠ‚ç‚¹ã€åŸŸåã€è¯ä¹¦ç­‰
- å½“å‰åˆ†2å°æœºå™¨éƒ¨ç½²ä¸€å°CPU ä¸€å°GPU
- 
#### æ¨¡å—åç§°:
Gatewayï¼ˆå…¥å£ç½‘å…³ï¼‰
Orchestratorï¼ˆç¼–æ’å™¨ï¼‰
Entity Coreï¼ˆå®ä½“æ ¸å¿ƒï¼‰
Asset Knowledgeï¼ˆç´ æçŸ¥è¯†åº“ï¼‰
Plannerï¼ˆè§„åˆ’å™¨ï¼‰
Model Routerï¼ˆæ¨¡å‹è·¯ç”±å™¨ï¼‰
Worker Hubï¼ˆæ‰§è¡Œä¸­æ¢ï¼‰
Worker Video / Audio / LLM / LipSyncï¼ˆæ‰§è¡Œå™¨ï¼‰
Composerï¼ˆåˆæˆå™¨ï¼‰
Observerï¼ˆè§‚æµ‹ä¸­å¿ƒï¼‰
Contractsï¼ˆé€šä¿¡å¥‘çº¦ï¼‰
Telemetryï¼ˆèŠ‚ç‚¹é¥æµ‹ï¼‰
Artifactsï¼ˆäº§ç‰©ï¼‰
Run / Job / Stage / Event / Artifactï¼ˆè¿è¡Œå¯¹è±¡å‘½åï¼‰

### SKILL_01~22 åˆ†å±‚æ˜ å°„ï¼ˆå¿…é¡»ç»Ÿä¸€ï¼‰
- `01~13`ï¼šæ ¸å¿ƒç”Ÿäº§é“¾ï¼ˆæ‘„å…¥ã€æŠ½å–ã€è§„åˆ’ã€æ‰§è¡Œã€è¯„ä¼°ã€å›æµï¼‰ã€‚
- `14~22`ï¼šå¢å¼ºæ²»ç†é“¾ï¼ˆäººæ ¼/ç­–ç•¥/è´¨é‡é—¨/æ•…éšœæ¢å¤/ç®—åŠ›é¢„ç®—/DSL/è¿ç»­æ€§/æ•°æ®é›†ç´¢å¼•ï¼‰ã€‚
- `14` Persona Style Packï¼šå®šä¹‰é£æ ¼ DNA ä¸ persona åŸºçº¿ï¼Œè¾“å‡ºç»™ `22/10/15/17`ã€‚
- `15` Creative Controlï¼šç­–ç•¥æ ˆè§£æä¸å†²çªæ²»ç†ï¼Œä½œä¸ºæ¸²æŸ“å‰çº¦æŸé—¨ã€‚
- `16` Critic Evaluationï¼šæ‰§è¡Œåè´¨é‡æ‰“åˆ†ä¸é—¨ç¦ï¼Œå†³å®š `pass/review/fail`ã€‚
- `17` Experiment A/Bï¼šå¯¹ persona/policy/prompt è¿›è¡Œå®éªŒç¼–æ’ä¸èƒœè€…æ¨å¹¿ã€‚
- `18` Failure Recoveryï¼šå¤±è´¥åˆ†çº§ã€é™çº§è·¯å¾„ã€è¡¥å¿åŠ¨ä½œã€äººå·¥æ¥ç®¡ã€‚
- `19` Compute Budgeterï¼šæŒ‰é¢„ç®—/ä¼˜å…ˆçº§åˆ†é…é•œå¤´ç®—åŠ›ï¼Œè¾“å‡ºé™çº§å»ºè®®ã€‚
- `20` Shot DSL Compilerï¼šå°† prompt/çº¦æŸç¼–è¯‘æˆåç«¯å¯æ‰§è¡Œ DSLã€‚
- `21` Entity Registry & Continuityï¼š`04 -> 21 -> 07`ï¼Œå›ºå®šè§’è‰²/åœºæ™¯/é“å…· identityã€‚
- `22` Persona Dataset & Indexï¼š`11+12+14 -> 22 -> 10/15/17`ï¼Œç®¡ç† dataset/index/persona è°±ç³»ã€‚

### å…±äº«åŒ…ï¼š
#### ainern2d-contracts
é‡Œé¢æ”¾ï¼š
- TaskSpec
- DispatchDecision
- EntityPack
- AssetCandidate
- ShotPlan
- TimelinePlan
- ArtifactMeta
- WorkerResult
- EventEnvelope
- ErrorCode
è¿™äº›æ˜¯ æœåŠ¡é€šä¿¡å¥‘çº¦
æ¯ä¸ªæœåŠ¡è‡ªå·±ç»´æŠ¤ï¼š
è‡ªå·±çš„ ORM æ¨¡å‹
è‡ªå·±çš„è¡¨ç»“æ„
è‡ªå·±çš„ Alembic migrations
ä¾‹å¦‚ï¼š
orchestrator æœ‰ render_runs, jobs, workflow_events
entity-core æœ‰ entity_records, entity_links
planner æœ‰ plans, timeline_segments, task_dags
å³ä½¿æœ‰é‡å¤æ¦‚å¿µï¼Œä¹Ÿæ²¡å…³ç³»ï¼ˆé€šè¿‡å¥‘çº¦è¿æ¥ï¼‰ã€‚


### ä¸­é—´ä»·
ä¸­é—´ä»¶ï¼ˆå»ºè®®ä¸€å¼€å§‹å°±æœ‰ï¼‰
1) PostgreSQL + pgvectorï¼‰
ç”¨é€”ï¼š
ç´ ææ£€ç´¢
é£æ ¼/è§’è‰²/åœºæ™¯ç›¸ä¼¼åº¦æ£€ç´¢
RAG æ£€ç´¢
å“ªäº›æ¨¡å—ç”¨ï¼š
asset-knowledgeï¼ˆæ ¸å¿ƒï¼‰
entity-coreï¼ˆè¾…åŠ©æ£€ç´¢ï¼‰
plannerï¼ˆæ‹¿å€™é€‰ç´ ææ—¶ç”¨ï¼‰
ç”¨é€”ï¼š
ä»»åŠ¡ã€è¿è¡Œè®°å½•ã€çŠ¶æ€æœºã€äº§ç‰©å…ƒæ•°æ®ã€å®ä½“ç»“æ„åŒ–ç»“æœã€è®¡åˆ’ç»“æœ
æ ¸å¿ƒä¸šåŠ¡æ•°æ®åº“
å“ªäº›æ¨¡å—ç”¨ï¼š
gatewayï¼ˆå°‘é‡è¯»å†™ï¼‰
orchestratorï¼ˆé‡åº¦ï¼‰
entity-coreï¼ˆè¯»å†™ï¼‰
plannerï¼ˆè¯»å†™ï¼‰
model-routerï¼ˆè¯»å°‘å†™å°‘ï¼‰
worker-hubï¼ˆçŠ¶æ€å›å†™ï¼‰
composerï¼ˆç»“æœå›å†™ï¼‰
observerï¼ˆç»Ÿè®¡æ¥æºä¹‹ä¸€ï¼‰
1) Redis
ç”¨é€”ï¼š
ç¼“å­˜
åˆ†å¸ƒå¼é”
çŸ­æœŸçŠ¶æ€
é™æµè®¡æ•°
å¹‚ç­‰é”®
å¯ä½œä¸ºè½»é‡é˜Ÿåˆ—ï¼ˆæ—©æœŸï¼‰
å“ªäº›æ¨¡å—ç”¨ï¼š
gatewayï¼ˆé™æµ/ä¼šè¯ç¼“å­˜/å¹‚ç­‰ï¼‰
orchestratorï¼ˆé”ã€çŠ¶æ€ç¼“å­˜ï¼‰
model-routerï¼ˆèŠ‚ç‚¹çŠ¶æ€ç¼“å­˜ï¼‰
worker-hubï¼ˆä»»åŠ¡çŸ­çŠ¶æ€ï¼‰
observerï¼ˆä¸´æ—¶è®¡æ•°ï¼‰
1) RabbitMQ ä¼˜å…ˆï¼‰
ç”¨é€”ï¼š
ä»»åŠ¡å¼‚æ­¥æŠ•é€’
äº‹ä»¶é©±åŠ¨è§£è€¦
æ‰§è¡Œç»“æœå›è°ƒäº‹ä»¶
å“ªäº›æ¨¡å—ç”¨ï¼š
orchestratorï¼ˆå‘ä»»åŠ¡ã€æ”¶äº‹ä»¶ï¼‰
model-routerï¼ˆå‘æ´¾å‘ä»»åŠ¡ï¼‰
worker-hub / worker-*ï¼ˆæ¶ˆè´¹æ‰§è¡Œä»»åŠ¡ï¼Œå›å‘ç»“æœï¼‰
composerï¼ˆæ¶ˆè´¹åˆæˆä»»åŠ¡ï¼‰
4) å¯¹è±¡å­˜å‚¨ï¼ˆS3/MinIOï¼‰
ç”¨é€”ï¼š
è§†é¢‘/éŸ³é¢‘/å›¾ç‰‡äº§ç‰©å­˜å‚¨
ä¸­é—´äº§ç‰©ï¼ˆåˆ†é•œå›¾ã€éŸ³è½¨ç‰‡æ®µã€å‚è€ƒå›¾ï¼‰
æœ€ç»ˆå¯¼å‡ºæ–‡ä»¶
å“ªäº›æ¨¡å—ç”¨ï¼š
worker-video/audio/lipsyncï¼ˆä¸Šä¼ äº§ç‰©ï¼‰
composerï¼ˆè¯»å†™ï¼‰
gatewayï¼ˆç­¾å URL / ä¸‹è½½é“¾æ¥ï¼‰
asset-knowledgeï¼ˆç´ æå­˜å‚¨ï¼‰
orchestratorï¼ˆåªå­˜å…ƒæ•°æ®ï¼Œä¸å­˜å¤§æ–‡ä»¶ï¼‰
âœ… ä¸è¦æŠŠå¤§æ–‡ä»¶å¡æ•°æ®åº“ã€‚
6) æ—¥å¿—ä¸è¿½è¸ªï¼ˆOpenTelemetry + Loki/ELK/Tempo/Jaeger ä»»é€‰ï¼‰
ç”¨é€”ï¼š
è·¨æ¨¡å—è¿½è¸ªä¸€æ¬¡ä»»åŠ¡ä»åˆ›å»ºåˆ°å¯¼å‡º
å®šä½å¤±è´¥æ­¥éª¤å’Œè€—æ—¶çƒ­ç‚¹
å“ªäº›æ¨¡å—ç”¨ï¼š
å…¨éƒ¨æ¨¡å—éƒ½åº”è¯¥æ¥å…¥ï¼ˆè‡³å°‘ gateway/orchestrator/router/workerï¼‰
âœ… æ—©æœŸå¯å…ˆç®€å•æ—¥å¿—ï¼Œåé¢åŠ  tracingã€‚
7) ä»»åŠ¡ç›‘æ§/æŒ‡æ ‡ï¼ˆPrometheus + Grafanaï¼‰
ç”¨é€”ï¼š
é˜Ÿåˆ—é•¿åº¦ã€GPUä½¿ç”¨ç‡ã€ä»»åŠ¡è€—æ—¶ã€å¤±è´¥ç‡
è·¯ç”±å¥åº·åº¦ã€workerååé‡
å“ªäº›æ¨¡å—ç”¨ï¼š
model-routerï¼ˆå…³é”®)
worker-hub / worker-*ï¼ˆå…³é”®ï¼‰
orchestratorï¼ˆå…³é”®ï¼‰
observerï¼ˆèšåˆå±•ç¤ºï¼‰

## å®¹å™¨è§„åˆ’
1) ainern2d-studio-apiï¼ˆä¸€ä¸ª FastAPI é¡¹ç›®ï¼‰
å†…éƒ¨æŒ‰æ¨¡å—åˆ†å±‚ï¼Œé€»è¾‘ä¸Šä¿ç•™ä½ è¿™äº›åå­—ï¼š
gatewayï¼ˆAPIå…¥å£ï¼‰
orchestratorï¼ˆæµç¨‹æ¨è¿›ï¼‰
entity_core
asset_knowledgeï¼ˆå…ˆç›´è¿ pgvectorï¼‰
planner
model_router
observerï¼ˆå…ˆè®°å½•æ—¥å¿—/æˆæœ¬åˆ°DBï¼‰

2) ainern2d-worker-hubï¼ˆä¸€ä¸ª FastAPI + é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼‰
æ¥æ”¶è°ƒåº¦ä»»åŠ¡
æŒ‰ç±»å‹åˆ†å‘ç»™å…·ä½“ worker
çŠ¶æ€å›å†™
artifact å…ƒæ•°æ®ç™»è®°
3) ainern2d-worker-runtimeï¼ˆå¯ä¸€ä¸ªä»“åº“å¤šä¸ª worker è¿›ç¨‹ï¼‰
video worker
audio worker
llm worker
lipsync worker
ğŸ‘‰ è¿™äº›é€šå¸¸ä¸éœ€è¦å¯¹å¤–å¼€æ”¾ HTTPï¼Œèµ° RabbitMQ/Redis Queue æ›´åˆé€‚ã€‚

4) ainern2d-composer
5) ainern2d-studio-web(vue3ç”¨æˆ·æ“ä½œç•Œé¢)

ainern2d/
â”œâ”€â”€ README.md
â”œâ”€â”€ .env.example
â”œâ”€â”€ docker-compose.yml                  # å¼€å‘ç¯å¢ƒæ€»ç¼–æ’ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ docker-compose.worker.yml           # å¯é€‰ï¼šå•ç‹¬æ‹‰ worker é›†ç¾¤
â”œâ”€â”€ docker-compose.observability.yml    # å¯é€‰ï¼šç›‘æ§æ—¥å¿—
â”œâ”€â”€ Makefile
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ dev-up.sh
â”‚   â”œâ”€â”€ dev-down.sh
â”‚   â”œâ”€â”€ migrate.sh
â”‚   â”œâ”€â”€ seed_rag.sh
â”‚   â””â”€â”€ init_storage.sh
â”‚
â”œâ”€â”€ infra/
â”‚   â”œâ”€â”€ nginx/                          # åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â””â”€â”€ nginx.conf
â”‚   â”œâ”€â”€ postgres/
â”‚   â”‚   â””â”€â”€ init.sql
â”‚   â”œâ”€â”€ rabbitmq/
â”‚   â”‚   â””â”€â”€ definitions.json
â”‚   â”œâ”€â”€ redis/
â”‚   â””â”€â”€ grafana/
â”‚       â””â”€â”€ provisioning/
â”‚
â”œâ”€â”€ shared/                             # è·¨æœåŠ¡å…±äº«ä»£ç ï¼ˆéå¸¸é‡è¦ï¼‰
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â””â”€â”€ ainern2d_shared/
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â”œâ”€â”€ settings.py
â”‚       â”‚   â””â”€â”€ enums.py
â”‚       â”œâ”€â”€ schemas/                    # pydantic DTO
â”‚       â”‚   â”œâ”€â”€ task.py
â”‚       â”‚   â”œâ”€â”€ artifact.py
â”‚       â”‚   â”œâ”€â”€ timeline.py
â”‚       â”‚   â””â”€â”€ events.py
â”‚       â”œâ”€â”€ db/
â”‚       â”‚   â”œâ”€â”€ models.py               # ä½ ç°æœ‰ models.py å¯é€æ­¥è¿å…¥
â”‚       â”‚   â”œâ”€â”€ session.py
â”‚       â”‚   â””â”€â”€ repositories/
â”‚       â”œâ”€â”€ queue/
â”‚       â”‚   â”œâ”€â”€ rabbitmq.py
â”‚       â”‚   â”œâ”€â”€ topics.py
â”‚       â”‚   â””â”€â”€ message_contracts.py
â”‚       â”œâ”€â”€ storage/
â”‚       â”‚   â”œâ”€â”€ s3.py
â”‚       â”‚   â””â”€â”€ minio.py
â”‚       â”œâ”€â”€ telemetry/
â”‚       â”‚   â”œâ”€â”€ logging.py
â”‚       â”‚   â”œâ”€â”€ metrics.py
â”‚       â”‚   â””â”€â”€ tracing.py
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ time.py
â”‚           â”œâ”€â”€ idempotency.py
â”‚           â””â”€â”€ retry.py
â”‚
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ ainern2d-studio-api/            # FastAPI é¡¹ç›® #1ï¼ˆæ¨èæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â”œâ”€â”€ alembic.ini
â”‚   â”‚   â”œâ”€â”€ alembic/
â”‚   â”‚   â””â”€â”€ app/
â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚       â”œâ”€â”€ api/                    # gateway èŒè´£
â”‚   â”‚       â”‚   â”œâ”€â”€ deps.py
â”‚   â”‚       â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚       â”‚   â”œâ”€â”€ v1/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ projects.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ tasks.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ timeline.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ assets.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ regenerate.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ preview.py
â”‚   â”‚       â”œâ”€â”€ modules/
â”‚   â”‚       â”‚   â”œâ”€â”€ orchestrator/       # é€»è¾‘æ¨¡å—ï¼Œä¸ä¸€å®šç‹¬ç«‹æœåŠ¡
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ service.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ state_machine.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ dag_engine.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ recovery.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ event_log.py
â”‚   â”‚       â”‚   â”œâ”€â”€ entity_core/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ extractor.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ normalizer.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ continuity.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ world_pack_builder.py
â”‚   â”‚       â”‚   â”œâ”€â”€ asset_knowledge/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ ingest.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ embedding.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ retrieval.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ hybrid_search.py
â”‚   â”‚       â”‚   â”œâ”€â”€ planner/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ creative_policy.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ production_scheduler.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ shot_plan.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ timeline_plan.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ budget_degrade.py
â”‚   â”‚       â”‚   â”œâ”€â”€ model_router/
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ router.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ provider_registry.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ health.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ dispatch_decision.py
â”‚   â”‚       â”‚   â”œâ”€â”€ governance/         # SKILL_14~22 å¢å¼ºæ²»ç†
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ persona_registry.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ policy_stack.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ critic_suite.py
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ recovery_engine.py
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ experiment_lab.py
â”‚   â”‚       â”‚   â””â”€â”€ observer/
â”‚   â”‚       â”‚       â”œâ”€â”€ cost_meter.py
â”‚   â”‚       â”‚       â”œâ”€â”€ audit.py
â”‚   â”‚       â”‚       â””â”€â”€ metrics_writer.py
â”‚   â”‚       â”œâ”€â”€ services/               # åº”ç”¨æœåŠ¡å±‚ï¼ˆç»„åˆ modulesï¼‰
â”‚   â”‚       â”œâ”€â”€ workers/                # å¯æ”¾åå°æ¶ˆè´¹è€…ï¼ˆåˆæœŸï¼‰
â”‚   â”‚       â””â”€â”€ tests/
â”‚   â”‚
â”‚   â”œâ”€â”€ ainern2d-worker-hub/            # FastAPI é¡¹ç›® #2
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ app/
â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚       â”œâ”€â”€ api/
â”‚   â”‚       â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”‚       â”œâ”€â”€ dispatch.py
â”‚   â”‚       â”‚       â”œâ”€â”€ callbacks.py
â”‚   â”‚       â”‚       â””â”€â”€ telemetry.py
â”‚   â”‚       â”œâ”€â”€ consumers/
â”‚   â”‚       â”‚   â”œâ”€â”€ dispatch_consumer.py
â”‚   â”‚       â”‚   â””â”€â”€ result_consumer.py
â”‚   â”‚       â”œâ”€â”€ dispatcher/
â”‚   â”‚       â”‚   â”œâ”€â”€ hub.py
â”‚   â”‚       â”‚   â”œâ”€â”€ routing_table.py
â”‚   â”‚       â”‚   â””â”€â”€ node_registry.py
â”‚   â”‚       â”œâ”€â”€ adapters/
â”‚   â”‚       â”‚   â”œâ”€â”€ worker_video_adapter.py
â”‚   â”‚       â”‚   â”œâ”€â”€ worker_audio_adapter.py
â”‚   â”‚       â”‚   â”œâ”€â”€ worker_llm_adapter.py
â”‚   â”‚       â”‚   â””â”€â”€ worker_lipsync_adapter.py
â”‚   â”‚       â””â”€â”€ tests/
â”‚   â”‚
â”‚   â”œâ”€â”€ ainern2d-worker-runtime/        # ä¸€ä¸ªä»“åº“ï¼Œå¤šä¸ª worker å…¥å£
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ app/
â”‚   â”‚       â”œâ”€â”€ main_video.py
â”‚   â”‚       â”œâ”€â”€ main_audio.py
â”‚   â”‚       â”œâ”€â”€ main_llm.py
â”‚   â”‚       â”œâ”€â”€ main_lipsync.py
â”‚   â”‚       â”œâ”€â”€ common/
â”‚   â”‚       â”‚   â”œâ”€â”€ base_worker.py
â”‚   â”‚       â”‚   â”œâ”€â”€ job_loop.py
â”‚   â”‚       â”‚   â””â”€â”€ result_reporter.py
â”‚   â”‚       â”œâ”€â”€ video/
â”‚   â”‚       â”‚   â”œâ”€â”€ comfyui_client.py
â”‚   â”‚       â”‚   â”œâ”€â”€ pipeline_i2v.py
â”‚   â”‚       â”‚   â”œâ”€â”€ pipeline_v2v.py
â”‚   â”‚       â”‚   â””â”€â”€ postprocess.py
â”‚   â”‚       â”œâ”€â”€ audio/
â”‚   â”‚       â”‚   â”œâ”€â”€ tts.py
â”‚   â”‚       â”‚   â”œâ”€â”€ bgm.py
â”‚   â”‚       â”‚   â”œâ”€â”€ sfx.py
â”‚   â”‚       â”‚   â””â”€â”€ align.py
â”‚   â”‚       â”œâ”€â”€ llm/
â”‚   â”‚       â”‚   â”œâ”€â”€ provider_openai.py
â”‚   â”‚       â”‚   â”œâ”€â”€ provider_deepseek.py
â”‚   â”‚       â”‚   â”œâ”€â”€ provider_qwen.py
â”‚   â”‚       â”‚   â””â”€â”€ tasks/
â”‚   â”‚       â”‚       â”œâ”€â”€ extract.py
â”‚   â”‚       â”‚       â”œâ”€â”€ translate.py
â”‚   â”‚       â”‚       â””â”€â”€ prompt_gen.py
â”‚   â”‚       â””â”€â”€ lipsync/
â”‚   â”‚           â”œâ”€â”€ engine.py
â”‚   â”‚           â””â”€â”€ align_report.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ainern2d-composer/              # FastAPI é¡¹ç›® #3ï¼ˆå¯åæ‹†ï¼‰
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ app/
â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚       â”œâ”€â”€ api/v1/compose.py
â”‚   â”‚       â”œâ”€â”€ timeline/
â”‚   â”‚       â”‚   â”œâ”€â”€ assembler.py
â”‚   â”‚       â”‚   â”œâ”€â”€ validator.py
â”‚   â”‚       â”‚   â””â”€â”€ exporter.py
â”‚   â”‚       â”œâ”€â”€ ffmpeg/
â”‚   â”‚       â”‚   â”œâ”€â”€ commands.py
â”‚   â”‚       â”‚   â””â”€â”€ runners.py
â”‚   â”‚       â””â”€â”€ tests/
â”‚   â”‚
â”‚   â””â”€â”€ ainern2d-studio-web/            # Vue3 å‰ç«¯
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ vite.config.ts
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ pages/
â”‚           â”œâ”€â”€ modules/
â”‚           â”‚   â”œâ”€â”€ tasks/
â”‚           â”‚   â”œâ”€â”€ timeline/
â”‚           â”‚   â”œâ”€â”€ assets/
â”‚           â”‚   â””â”€â”€ preview/
â”‚           â”œâ”€â”€ components/
â”‚           â”œâ”€â”€ stores/
â”‚           â”œâ”€â”€ api/
â”‚           â””â”€â”€ types/
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ architecture/
    â”‚   â”œâ”€â”€ system-overview.md
    â”‚   â”œâ”€â”€ module-boundaries.md
    â”‚   â”œâ”€â”€ event-contracts.md
    â”‚   â””â”€â”€ deployment-topology.md
    â”œâ”€â”€ runbooks/
    â””â”€â”€ decisions/

## å†³ç­–Aå®æ–½ï¼ˆ2026-02ï¼‰

### å†³ç­–
- å…±äº«æ¨¡å‹ä¸æœåŠ¡ç§æœ‰è¡¨å¹¶è¡Œè§„åˆ’ã€‚
- å…±äº«å­—æ®µæ ‡å‡†ä¼˜å…ˆè½åœ°ï¼Œå†åšæœåŠ¡æ˜ å°„ã€‚

### å…±äº«å­—æ®µæ ‡å‡†ï¼ˆå¿…é¡»ä¸€è‡´ï¼‰
- tenant_id
- project_id
- trace_id
- correlation_id
- idempotency_key
- error_code
- version
- created_at / updated_at / deleted_at

### å®æ–½æ–‡æ¡£å…¥å£
- Agentå¯åŠ¨å…¥å£ï¼š`START_HERE_FOR_AGENTS.md`
- å¥‘çº¦ï¼š`ainer_contracts.md`
- äº‹ä»¶ï¼š`ainer_event_types.md`
- é”™è¯¯ç ï¼š`ainer_error_code.md`
- ç³»ç»Ÿæ€»è§ˆï¼š`code/docs/architecture/system-overview.md`
- æ¨¡å—è¾¹ç•Œï¼š`code/docs/architecture/module-boundaries.md`
- äº‹ä»¶å¥‘çº¦ï¼š`code/docs/architecture/event-contracts.md`
- æœåŠ¡APIå¥‘çº¦ï¼š`code/docs/architecture/service-api-contracts.md`
- é˜Ÿåˆ—ä¸é‡è¯•ç­–ç•¥ï¼š`code/docs/architecture/queue-topics-and-retry-policy.md`
- Stageæƒå¨æšä¸¾ï¼š`code/docs/architecture/stage-enum-authority.md`
- Studioæ¥å£æ˜ å°„ï¼š`code/docs/architecture/studio-web-api-mapping.md`
- Skillæœºå™¨æ¨¡æ¿ï¼š`code/docs/architecture/skill-schema-template.md`
- å­—æ®µæ˜ å°„æ¸…å•ï¼š`code/docs/architecture/shared-field-mapping-matrix.md`
- ç†æƒ³æ¨¡å‹è“å›¾ï¼š`code/docs/architecture/ideal-db-model-blueprint.md`
- Alembicæ‹†è§£ï¼š`code/docs/runbooks/alembic-migration-plan-p0-p2.md`
- ç¬¬äºŒè½®å®æ–½æ¸…å•ï¼š`code/docs/runbooks/round2-implementation-checklist.md`
- å®æ–½çŠ¶æ€è´¦æœ¬ï¼š`code/docs/runbooks/implementation-status-ledger.md`
- CIé—¨ç¦æ‰§è¡Œè§„èŒƒï¼š`code/docs/runbooks/ci-gate-execution-spec.md`
- Agentæ‰§è¡Œé¡ºåºï¼š`code/docs/runbooks/agent-implementation-playbook.md`
- Agentæ•°æ®æ¨¡å‹è½åœ°æŒ‡å—ï¼š`code/docs/architecture/agent-data-model-guideline.md`
- Agentç¼–ç æ¡†æ¶ä¸ä»£ç ç”Ÿæˆæ¨¡æ¿æŒ‡å—ï¼š`code/docs/architecture/agent-coding-framework-guideline.md`
- éƒ¨ç½²æ‹“æ‰‘ï¼š`code/docs/architecture/deployment-topology.md`
- E2Eäº¤æ¥éªŒæ”¶ï¼š`code/docs/runbooks/e2e-handoff-test-matrix.md`
- Skillçº¿ä¸Šéƒ¨ç½²ï¼š`code/docs/runbooks/skill-online-deployment.md`
- P1æ²»ç†è®¡åˆ’ï¼š`code/docs/runbooks/p1-ops-governance-plan.md`
- 01~22æ¥å…¥è¯´æ˜ï¼š`README_21_22_INTEGRATION_GUIDE.md`

### é—­ç¯ä¸»æµç¨‹
- ç™»å½•é‰´æƒ -> å†…å®¹æ‘„å…¥(`01`) -> è¯­è¨€è·¯ç”±(`02`) -> åˆ†é•œè§„åˆ’(`03`) -> å®ä½“æŠ½å–(`04`) -> è¿ç»­æ€§æ³¨å†Œ(`21`) -> canonicalization(`07`) -> èµ„äº§åŒ¹é…(`08`) -> RAG/Persona(`11/12/14/22`) -> ç­–ç•¥ä¸é¢„ç®—(`15/19`) -> æ¸²æŸ“è§„åˆ’ä¸ç¼–è¯‘(`09/10/20`) -> æ‰§è¡Œæ¸²æŸ“(workers) -> è´¨é‡é—¨(`16`) -> æ•…éšœæ¢å¤(`18`) -> åé¦ˆè¿›åŒ–(`13`) -> A/Bé£è½®(`17`)ã€‚

### 01~22èŒè´£è¾¹ç•Œä¸è°ƒç”¨ä¸»é“¾ï¼ˆç»Ÿä¸€ç‰ˆï¼‰

#### è°ƒç”¨ä¸»é“¾ï¼ˆæƒå¨ï¼‰
- `01 gateway`ï¼šæ¥å…¥ä¸æŸ¥è¯¢å…¥å£ï¼Œä»…åšé‰´æƒ/æ ¡éªŒ/å¹‚ç­‰ï¼Œä¸åšä¸šåŠ¡ç¼–æ’ã€‚
- `02 orchestrator`ï¼šæµç¨‹çŠ¶æ€æœºæƒå¨ï¼Œè´Ÿè´£é˜¶æ®µæ¨è¿›ã€é‡è¯•/è¡¥å¿ã€äº‹ä»¶é©±åŠ¨ã€‚
- `03 entity-core`ï¼šå®ä½“æŠ½å–ä¸å½’ä¸€åŒ–ï¼Œè¾“å‡ºä¸–ç•Œè§‚ä¸å®ä½“åŒ…ã€‚
- `04 asset-knowledge`ï¼šç´ æä¸çŸ¥è¯†æ£€ç´¢ï¼Œè¾“å‡ºå€™é€‰èµ„äº§ä¸çº¦æŸå…ƒæ•°æ®ã€‚
- `05 planner`ï¼šåœºæ™¯/é•œå¤´/æ—¶åºè®¡åˆ’æƒå¨ï¼Œäº§å‡ºå¯æ‰§è¡Œä»»åŠ¡å›¾ã€‚
- `06 model-router`ï¼šæ¨¡å‹ä¸èµ„æºå†³ç­–æƒå¨ï¼Œè¾“å‡ºæ‰§è¡Œè·¯ç”±å†³ç­–ã€‚
- `07 worker-hub`ï¼šä»»åŠ¡åˆ†å‘ä¸çŠ¶æ€å›å†™ä¸­æ¢ï¼Œç®¡ç† worker ç”Ÿå‘½å‘¨æœŸã€‚
- `08/09/10/11 workers`ï¼šåˆ†åˆ«æ‰§è¡Œè§†é¢‘/éŸ³é¢‘/LLM/lipsync åŸå­ä»»åŠ¡ã€‚
- `12 composer`ï¼šæœ€ç»ˆåˆæˆä¸å¯¼å‡ºæƒå¨ï¼Œäº§å‡ºå‘å¸ƒçº§ artifactã€‚
- `13 observer`ï¼šè§‚æµ‹ã€å®¡è®¡ã€æˆæœ¬ä¸SLAæƒå¨ï¼Œä¸æ”¹å†™ä¸šåŠ¡çŠ¶æ€ã€‚

#### SKILL ä¸»é“¾ï¼ˆæƒå¨ï¼Œ01~22ï¼‰
1. `01` Story Ingestion
2. `02` Language Context Router
3. `03` Story->Scene->Shot Planner
4. `04` Entity Extraction
5. `21` Entity Registry & Continuity Manager
6. `05` Audio Asset Planner
7. `06` Audio Timeline Composer
8. `07` Entity Canonicalization + Cultural Binding
9. `08` Asset Matcher
10. `11` RAG KB Manager
11. `12` RAG Pipeline Embedding
12. `14` Persona Style Pack Manager
13. `22` Persona Dataset & Index Manager
14. `15` Creative Control Policy
15. `19` Compute-Aware Shot Budgeter
16. `09` Visual Render Planner
17. `10` Prompt Planner
18. `20` Shot DSL Compiler
19. æ‰§è¡Œæ¸²æŸ“ï¼ˆworkersï¼‰
20. `16` Critic Evaluation
21. `18` Failure Recovery & Degradation
22. `13` Feedback Evolution Loop
23. `17` Experiment A/B Orchestrator

#### 14~22 èå…¥åˆ° 01~13 çš„ç¡¬çº¦æŸï¼ˆé˜²è·‘åï¼‰
- `21` å¿…é¡»åœ¨ `04` ä¹‹åã€`07` ä¹‹å‰æ‰§è¡Œï¼›`07/08/10/16` åªèƒ½æ¶ˆè´¹å·²å›ºå®š `entity_id` çš„ç»“æœã€‚
- `22` å¿…é¡»åœ¨ `11/12/14` ä¹‹åæ‰§è¡Œï¼›`10/15/17` åªèƒ½æ¶ˆè´¹ `22` è¾“å‡ºçš„ runtime persona ç»‘å®šã€‚
- `15` ä¸ `19` å¿…é¡»åœ¨ `09/10/20` ä¹‹å‰å®Œæˆçº¦æŸæ³¨å…¥ï¼Œé¿å…æ‰§è¡Œé˜¶æ®µå†æ”¹è¯­ä¹‰ã€‚
- `16` å¤±è´¥åä¼˜å…ˆè¿›å…¥ `18` çš„é™çº§/è¡¥å¿è·¯å¾„ï¼Œä¸å…è®¸ç›´æ¥ç»•è¿‡è´¨é‡é—¨å‡ºç‰‡ã€‚
- `13` ä¸ `17` å½¢æˆé—­ç¯ï¼š`13` äº§å‡ºæ”¹è¿›ææ¡ˆï¼Œ`17` éªŒè¯å¹¶å†³å®šæ˜¯å¦æ¨å¹¿ã€‚

#### è¾¹ç•Œçº¦æŸï¼ˆå¿…é¡»éµå®ˆï¼‰
- ä¸Šæ¸¸ä¸å¾—ç»•è¿‡ `02` ç›´æ¥è°ƒåº¦ workerã€‚
- `05` åªäº§è®¡åˆ’ï¼Œä¸ç›´æ¥è½æ‰§è¡ŒçŠ¶æ€ã€‚
- `06` åªåšè·¯ç”±å†³ç­–ï¼Œä¸ç›´æ¥ç¼–æ’ä¸šåŠ¡æµã€‚
- `07` åªåšæ‰§è¡Œæ§åˆ¶ï¼Œä¸ä¿®æ”¹ä¸šåŠ¡è¯­ä¹‰æ•°æ®ã€‚
- `13` åªåšè§‚æµ‹ä¸å®¡è®¡ï¼Œä¸åå‘æ”¹å†™è¿è¡Œæ€ã€‚

#### äº‹ä»¶å½’å±ï¼ˆå”¯ä¸€æƒå¨ï¼‰
- æµç¨‹çŠ¶æ€äº‹ä»¶ï¼š`02 orchestrator`ã€‚
- è·¯ç”±å†³ç­–äº‹ä»¶ï¼š`06 model-router`ã€‚
- æ‰§è¡Œå›æ‰§äº‹ä»¶ï¼š`07 worker-hub` ä¸å„ workerã€‚
- åˆæˆå‘å¸ƒäº‹ä»¶ï¼š`12 composer`ã€‚
- å‘Šè­¦è§‚æµ‹äº‹ä»¶ï¼š`13 observer`ã€‚
