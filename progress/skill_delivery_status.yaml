meta:
  version: "1.0"
  snapshot_at: "2026-02-27"
  source_of_truth:
    - "README_21_22_INTEGRATION_GUIDE.md"
    - "START_HERE_FOR_AGENTS.md"
    - "code/docs/runbooks/implementation-status-ledger.md"
    - "progress/PREIMPLEMENTATION_READINESS_REPORT.md"
  db_alignment:
    status: "DONE"
    migration:
      - "code/apps/alembic/versions/0f2b6c9b0c7f_align_skill_21_22_schema.py"
    covered:
      - "jobtype enum values: resolve_entity_continuity / manage_persona_dataset_index"
      - "tables: entity_instance_links / entity_continuity_profiles / entity_preview_variants / character_voice_bindings"
      - "tables: persona_dataset_bindings / persona_index_bindings / persona_lineage_edges / persona_runtime_manifests"
    verification:
      - "python3 -m py_compile code/apps/alembic/versions/0f2b6c9b0c7f_align_skill_21_22_schema.py"
      - "python3 -m alembic heads -> 0f2b6c9b0c7f (head)"
      - "DATABASE_URL=postgresql+psycopg2://ainer:ainer_dev_2024@localhost:5432/ainer_dev python3 -m alembic upgrade head"
      - "DATABASE_URL=postgresql+psycopg2://ainer:ainer_dev_2024@localhost:5432/ainer_dev python3 code/scripts/validate_skill_21_22_persistence_realdb.py"
      - "pytest: tests/skills/test_skill_registry_dispatcher.py"
      - "pytest: tests/test_modules.py"
      - "pytest: tests/skills/test_skills_21_22.py"
    pending: []
  framework_validation:
    script: "code/scripts/validate_skill_framework.py"
    last_run_report: "progress/MODEL_CONFIRMATION_REPORT.md"
    latest_result: "PASS"
    latest_summary:
      pass: 11
      fail: 0
      warn: 0
    latest_warn: []
  preimplementation_validation:
    script: "code/scripts/validate_preimplementation_readiness.py"
    last_run_report: "progress/PREIMPLEMENTATION_READINESS_REPORT.md"
    latest_result: "GO"
    latest_summary:
      pass: 6
      fail: 0
      warn: 0
    mode: "strict"
    latest_warn: []
  status_enum:
    - "NOT_STARTED"
    - "PARTIAL"
    - "SERVICE_READY"
    - "INTEGRATION_READY"
    - "DONE"
  gate_enum:
    - "PASS"
    - "REVIEW_REQUIRED"
    - "BLOCKING"
  validation_anchors:
    c010_compatibility: 'status: "INTEGRATION_READY"'

skills:
  - skill_id: "SKILL_01"
    name: "Story Ingestion & Normalization"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_01_STORY_INGESTION_NORMALIZATION.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_01.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_01_story_ingestion.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_02"
    name: "Language Context Router"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_02_LANGUAGE_CONTEXT_ROUTER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_02.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_02_language_context.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_03"
    name: "Story Scene Shot Planner"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_03_STORY_SCENE_SHOT_PLANNER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_03.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_03_scene_shot_plan.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    evidence:
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_03_21_07.py -q -> 1 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skill03_error_mapping.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-api/app/api/error_mapping.py (ValueError -> structured error contract)"
    next_action: []

  - skill_id: "SKILL_04"
    name: "Entity Extraction & Structuring"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_04_ENTITY_EXTRACTION_STRUCTURING.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_04.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_04_entity_extraction.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    evidence:
      - "code/shared/ainern2d_shared/schemas/skills/skill_04.py (continuity_handoff DTO)"
      - "code/apps/ainern2d-studio-api/app/services/skills/skill_04_entity_extraction.py (continuity_handoff build)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_04_21.py -q -> 1 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_03_21_07.py -q -> 1 passed"
    next_action: []

  - skill_id: "SKILL_05"
    name: "Audio Asset Planner"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_05_AUDIO_ASSET_PLANNER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_05.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_05_audio_asset_plan.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/services/skills/skill_05_audio_asset_plan.py (_derive_review_required_items + REVIEW_REQUIRED state)"
      - "code/shared/ainern2d_shared/schemas/skills/skill_05.py (review_required_items)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_05_08.py -q -> 13 passed"
    next_action: []

  - skill_id: "SKILL_06"
    name: "Audio Timeline Composer"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_06_AUDIO_TIMELINE_COMPOSER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_06.py"
    service: "code/apps/ainern2d-composer/app/services/skills/skill_06_audio_timeline.py"
    dispatch_binding:
      type: "composer_dispatcher"
      path: "code/apps/ainern2d-composer/app/services/skill_dispatcher.py"
    evidence:
      - "code/shared/ainern2d_shared/schemas/skills/skill_06.py (timeline_final.tracks 分组契约 + track_layers 兼容层)"
      - "code/apps/ainern2d-composer/app/services/skills/skill_06_audio_timeline.py (_build_tracks_contract 输出规范轨道结构)"
      - "pytest code/apps/ainern2d-composer/tests/skills/test_skills_06_20.py -q -k TestSkill06 -> 9 passed"
      - "pytest code/apps/ainern2d-composer/tests/skills/test_skills_06_20.py -q -> 16 passed"
    next_action: []

  - skill_id: "SKILL_07"
    name: "Entity Canonicalization & Cultural Binding"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_07_ENTITY_CANONICALIZATION_CULTURAL_BINDING.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_07.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_07_canonicalization.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    evidence:
      - "code/shared/ainern2d_shared/schemas/skills/skill_07.py (Skill07Input 增加 continuity 输入; canonical/mapping 增加 entity_id 兼容字段)"
      - "code/apps/ainern2d-studio-api/app/services/skills/skill_07_canonicalization.py (_build_entity_id_map 消费 SKILL21 resolved_entities)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_05_08.py -q -k TestSkill07 -> 5 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_03_21_07.py -q -> 1 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_21_22.py -q -k e2e_021 -> 1 passed"
    next_action: []

  - skill_id: "SKILL_08"
    name: "Asset Matcher"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_08_ASSET_MATCHER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_08.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_08_asset_matcher.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    evidence:
      - "code/shared/ainern2d_shared/schemas/skills/skill_08.py (新增 asset_library_index 输入字段)"
      - "code/apps/ainern2d-studio-api/app/services/skills/skill_08_asset_matcher.py (_extract_index_assets + index-first retrieval chain)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_05_08.py -q -k TestSkill08 -> 7 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_05_08.py -q -> 16 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_03_21_07.py -q -> 1 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_21_22.py -q -k e2e_021 -> 1 passed"
    next_action: []

  - skill_id: "SKILL_09"
    name: "Visual Render Planner"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_09_VISUAL_RENDER_PLANNER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_09.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_09_visual_render_plan.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    evidence:
      - "code/shared/ainern2d_shared/schemas/skills/skill_09.py (状态机枚举命名与 SKILL_09 规格对齐，保留旧值兼容别名)"
      - "code/apps/ainern2d-studio-api/app/services/skills/skill_09_visual_render_plan.py (state transition 全链路切换为 AUDIO_FEATURES_AGGREGATING/MOTION_SCORING/STRATEGY_MAPPING/MICROSHOT_SPLITTING)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_09_12.py -q -k TestSkill09 -> 5 passed"
    next_action: []

  - skill_id: "SKILL_10"
    name: "Prompt Planner"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_10_PROMPT_PLANNER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_10.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_10_prompt_planner.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_11"
    name: "RAG KB Manager"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_11_RAG_KB_MANAGER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_11.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_11_rag_kb_manager.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_12"
    name: "RAG Pipeline Embedding"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_12_RAG_PIPELINE_EMBEDDING.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_12.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_12_rag_embedding.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_13"
    name: "Feedback Evolution Loop"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_13_FEEDBACK_EVOLUTION_LOOP.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_13.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_13_feedback_loop.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_14"
    name: "Persona Style Pack Manager"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_14_PERSONA_STYLE_PACK_MANAGER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_14.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_14_persona_style.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_15"
    name: "Creative Control Policy"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_15_CREATIVE_CONTROL_POLICY.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_15.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_15_creative_control.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_16"
    name: "Critic Evaluation Suite"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_16_CRITIC_EVALUATION_SUITE.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_16.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_16_critic_evaluation.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_17"
    name: "Experiment A/B Test Orchestrator"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_17_EXPERIMENT_AB_TEST_ORCHESTRATOR.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_17.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_17_experiment.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_18"
    name: "Failure Recovery & Degradation"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_18_FAILURE_RECOVERY_DEGRADATION_POLICY.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_18.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_18_failure_recovery.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_19"
    name: "Compute-Aware Shot Budgeter"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_19_COMPUTE_AWARE_SHOT_BUDGETER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_19.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_19_compute_budget.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    next_action: []

  - skill_id: "SKILL_20"
    name: "Shot DSL Compiler & Prompt Backend"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_20_SHOT_DSL_COMPILER_PROMPT_BACKEND.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_20.py"
    service: "code/apps/ainern2d-composer/app/services/skills/skill_20_dsl_compiler.py"
    dispatch_binding:
      type: "composer_dispatcher"
      path: "code/apps/ainern2d-composer/app/services/skill_dispatcher.py"
    next_action: []

  - skill_id: "SKILL_21"
    name: "Entity Registry & Continuity Manager"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_21_ENTITY_REGISTRY_CONTINUITY_MANAGER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_21.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_21_entity_registry_continuity.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    existing_assets:
      - "code/shared/ainern2d_shared/ainer_db_models/preview_models.py"
      - "code/apps/ainern2d-studio-api/app/api/v1/preview.py"
      - "code/apps/alembic/versions/0f2b6c9b0c7f_align_skill_21_22_schema.py"
      - "code/scripts/validate_skill_21_22_persistence_realdb.py"
      - "code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_21_22.py"
      - "code/apps/ainern2d-studio-api/tests/skills/test_skill21_api_db_e2e.py"
    evidence:
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_21_22.py -k TestSkill21 -q -> 3 passed"
      - "DATABASE_URL=... pytest code/apps/ainern2d-studio-api/tests/skills/test_skill21_api_db_e2e.py -q -> 1 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_21_22.py -k e2e_021 -q -> 1 passed"
    next_action: []

  - skill_id: "SKILL_22"
    name: "Persona Dataset & Index Manager"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_22_PERSONA_DATASET_INDEX_MANAGER.md"
    dto: "code/shared/ainern2d_shared/schemas/skills/skill_22.py"
    service: "code/apps/ainern2d-studio-api/app/services/skills/skill_22_persona_dataset_index.py"
    dispatch_binding:
      type: "studio_registry"
      path: "code/apps/ainern2d-studio-api/app/services/skill_registry.py"
    existing_assets:
      - "code/shared/ainern2d_shared/ainer_db_models/preview_models.py"
      - "code/apps/alembic/versions/0f2b6c9b0c7f_align_skill_21_22_schema.py"
      - "code/scripts/validate_skill_21_22_persistence_realdb.py"
      - "code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_21_22.py"
      - "code/apps/ainern2d-studio-api/tests/skills/test_skill22_api_db_e2e.py"
    evidence:
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_21_22.py -k TestSkill22 -q -> 5 passed"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_e2e_handoff_21_22.py -k e2e_022 -q -> 1 passed"
      - "DATABASE_URL=... pytest code/apps/ainern2d-studio-api/tests/skills/test_skill22_api_db_e2e.py -q -> 1 passed"
    next_action: []

  - skill_id: "SKILL_23"
    name: "Studio Auth / User / Org"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_23_STUDIO_AUTH_USER_ORG.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/auth.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/auth.py (/logout, /projects/{project_id}/acl, /audit/logs)"
      - "code/apps/ainern2d-studio-api/app/api/error_mapping.py (HTTPException/ValidationError/ValueError/Exception 统一结构化错误对象)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/{App.vue,router/index.ts,stores/auth.ts,pages/LoginPage.vue,pages/StudioAuthPage.vue} (Naive UI admin shell + unified login guard + 登录页多语言选择)"
      - "npm run build (ainern2d-studio-web) -> PASS"
      - "code/apps/ainern2d-studio-web/vite.config.ts + code/docker-compose.yml (修复容器内 5173->api 代理目标，登录 500 消除)"
      - "code/apps/ainern2d-studio-api/app/api/v1/auth.py (默认测试账号自动引导 + 密码校验 + register 幂等冲突映射)"
      - "code/apps/ainern2d-studio-api/app/security/auth_token.py + app/main.py (Bearer 验签中间件 + RBAC 角色门禁：viewer/editor/admin + project 级 ACL 强制校验)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skill23_rbac_middleware.py -q -> 3 passed"
      - "TASK_CARD_23_ACL_STRONG: 细粒度 ACL 动态校验 - main.py (_has_project_acl 增强返回 user_role + _ADMIN_ROUTES 集合 + middleware 优化)"
      - "TASK_CARD_23_ACL_STRONG: projects.py 创建时自动为创建者添加 ProjectMember(admin)"
      - "TASK_CARD_23_ACL_STRONG: 同 token 在不同 project 权限不同 + viewer/editor/admin 生效 + 无 ACL 返回结构化拒绝"
    next_action: []

  - skill_id: "SKILL_24"
    name: "Project / Novel / Chapter Manager"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_24_PROJECT_NOVEL_CHAPTER_MANAGER.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/novels.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/novels.py (novel/chapter CRUD + revision history + chapter preview 01~03 + chapter->task)"
      - "code/apps/ainern2d-studio-api/app/api/v1/novels.py (/chapters/{chapter_id}/assist-expand：优先调用配置 Provider LLM，失败回退模板扩写)"
      - "code/apps/ainern2d-studio-api/app/api/v1/novels.py + app/services/telegram_notify.py (assist-expand 触发 plan.prompt.generated 通知)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/pages/{StudioNovelLibraryPage.vue,StudioChapterWorkspacePage.vue} (小说与章节工作区拆分：先小说列表再章节管理)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioChapterWorkspacePage.vue (章节编辑工作区：Markdown 左编辑右预览、保存/预览/修订/AI扩写按钮)"
      - "code/apps/ainern2d-studio-web/src/router/index.ts + src/App.vue (24 菜单分层：小说管理 / 章节工作区)"
      - "npm --prefix code/apps/ainern2d-studio-web run build -> PASS"
      - "TASK_CARD_24_CHAPTER_APPROVAL_DIFF: 添加章节发布审批流 + PR 式 diff 可视化"
      - "API: GET /chapters/{chapter_id}/publish-status (查询状态) + POST /chapters/{chapter_id}/publish-approval (submit/approve/reject) + GET /chapters/{chapter_id}/diff"
      - "状态流转: draft → pending (submit) → released (approve) 或 draft (reject)"
      - "Diff 计算: 行级别对比，返回 additions/deletions 统计与详细行差异"
    next_action: []

  - skill_id: "SKILL_25"
    name: "Config Center / API Model Router"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_25_CONFIG_CENTER_API_MODEL_ROUTER.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/config_center.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (provider token+capability 配置、provider/profile CRUD、stage-routing+feature_routes、feature-matrix、telegram-settings、health)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (/telegram-settings/test：后台可点击发送测试消息)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (/bootstrap-defaults：LangGraph StateGraph 编排角色/技能/路由/语言/stage路由)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (bootstrap 状态图改为 TypedDict StateGraph，修复 roles/skills/routes 计数丢失)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (/bootstrap-defaults 支持 model_profile_id/role_ids/enrich_rounds/session_id)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (/role-studio/run-skill + bootstrap-defaults 接入 Telegram 事件通知)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (telegram notify_events 默认扩展到 job.created/plan.prompt.generated/rag.embedding.completed)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (RoleProfile/SkillRegistry/FeatureRouteMap/RoleStudio Resolve 配置接口)"
      - "code/apps/ainern2d-studio-api/app/api/v1/tasks.py (run snapshot freeze includes provider/router/language/telegram payload)"
      - "code/apps/ainern2d-studio-api/app/services/telegram_notify.py (统一 TG 通知器：notify_events 过滤 + 结构化事件摘要)"
      - "DATABASE_URL=... pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py::test_skill_25_26_27_29_30_config_rag_culture_assets_timeline_patch_flow -q -> 1 passed"
      - "code/apps/ainern2d-studio-web/src/pages/StudioProviderRouterPage.vue (Provider CRUD + Telegram 配置 + 初始化向导)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioProviderRouterPage.vue + src/api/product.ts (bootstrap-defaults 支持 model_profile_id/role_ids/enrich_rounds/session_id)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioProviderRouterPage.vue (/ws/bootstrap/{session_id} 实时事件控制台：started/enriching/inserted/completed/failed)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioModelRoutingPage.vue (Model Profile + Feature Route Map 独立页面)"
      - "code/apps/ainern2d-studio-web/src/pages/DashboardPage.vue (首页提供一键初始化基础数据按钮)"
      - "code/apps/ainern2d-studio-web/src/pages/{StudioRoleConfigPage.vue,StudioRoleStudioPage.vue} + src/router/index.ts + src/App.vue (角色配置与工作台拆页，避免拥挤)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (/role-studio/run-skill 统一执行入口：已注册 skill 真实执行 + 未注册 skill 配置模拟)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioRoleStudioPage.vue + src/api/product.ts (Skill Runner 面板：role+skill 输入执行、输出与日志回显)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py (/language-settings 多语言策略 API) + code/apps/ainern2d-studio-web/src/pages/StudioLanguageSettingsPage.vue (中英/小语种配置 UI)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py + code/apps/ainern2d-studio-web/src/api/product.ts + code/apps/ainern2d-studio-web/src/pages/StudioProviderRouterPage.vue (provider test-connection API + 单条/批量健康探测)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioModelRoutingPage.vue (feature routing 可视化绑定：功能->profile 下拉 + capability 兼容校验)"
      - "npm run build (ainern2d-studio-web) -> PASS"
      - "TASK_CARD_25_PROVIDER_QUOTA_LIMIT: 增强 ProviderConnectionTestResponse，添加 quota_remaining/rate_limit_remaining/cost_estimate"
      - "TASK_CARD_25_ROLESTUDIO_ASYNC_COST: 添加异步执行端点 POST /role-studio/run-skill-async（返回 job_id）+ GET /role-studio/async-job/{job_id}（查询状态与成本）"
    next_action: []

  - skill_id: "SKILL_26"
    name: "RAG / KB / Dataset / Persona Console"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_26_RAG_KB_DATASET_PERSONA_CONSOLE.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/rag_console.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/rag_console.py (collection/version/persona/binding/preview + keyword 过滤 + 删除接口)"
      - "code/apps/ainern2d-studio-api/app/api/v1/rag_console.py (knowledge-packs/bootstrap + knowledge-packs list + import-jobs create/list，含增量去重与变化报告)"
      - "code/apps/ainern2d-studio-api/app/api/v1/rag_console.py + app/services/telegram_notify.py (import-jobs 完成后触发 rag.embedding.completed 通知)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/pages/StudioRagPersonaPage.vue (列表/增删查/过滤 + 初始化导演数据)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioRoleStudioPage.vue + src/api/product.ts (Knowledge Bootstrapping / Import Center 可视化接线)"
      - "TASK_CARD_26_BINARY_IMPORT_ASYNC: 添加二进制文件导入支持"
      - "POST /collections/{collection_id}/binary-import: 上传 PDF/XLSX/DOCX/TXT 文件进行异步导入"
      - "GET /binary-import/{import_job_id}: 查询导入任务状态与进度"
      - "支持文件格式: PDF, XLSX, DOCX, TXT（50MB 限制）"
      - "异步处理: 文件上传→文本提取→chunk→embedding→入库"
      - "内存存储实现，生产环境应改用数据库/Redis"
    next_action: []

  - skill_id: "SKILL_27"
    name: "World / Culture Pack Manager"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_27_WORLD_CULTURE_PACK_MANAGER.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/culture_packs.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/culture_packs.py (culture pack CRUD/version/export + keyword 过滤 + 删除)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/pages/StudioCulturePackPage.vue (culture pack 列表/增删查/过滤 + 导出)"
      - "code/apps/ainern2d-studio-api/app/api/v1/culture_packs.py (GET /templates 返回4个预定义文化包模板)"
      - "code/apps/ainern2d-studio-api/app/api/v1/culture_packs.py (POST /validate 约束校验：视觉规则冲突检测、签牌规则验证、服装/道具约束校验)"
    next_action: []

  - skill_id: "SKILL_28"
    name: "Task / Run Orchestration UI"
    status: "DONE"
    gate: "PASS"
    spec: "SKILL_28_TASK_RUN_ORCHESTRATION_UI.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/tasks.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/tasks.py (task submit + frozen snapshot + run snapshot query；包含 language/telegram snapshot)"
      - "code/apps/ainern2d-studio-api/app/api/v1/tasks.py + app/services/telegram_notify.py (task.submitted 事件通知接入 TG)"
      - "code/apps/ainern2d-studio-api/app/api/v1/config_center.py + app/api/v1/novels.py + app/api/v1/rag_console.py + app/api/v1/timesline.py (跨模块 TG 通知链路统一复用 notify_telegram_event)"
      - "code/apps/ainern2d-studio-api/app/services/telegram_notify.py + app/api/v1/orchestrator.py + app/main.py (TG 失败消息入 alert.events 队列重试 + circuit breaker 短路保护)"
      - "code/apps/ainern2d-studio-api/app/api/v1/novels.py (/chapters/{chapter_id}/tasks)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/pages/StudioRunCenterPage.vue (任务提交/Run Snapshot 独立页面 + 快速选章)"
      - "code/apps/ainern2d-studio-web/src/api/product.ts + code/apps/ainern2d-studio-web/src/pages/StudioRunCenterPage.vue (Run 详情 + Prompt 回放 + Policy 回放可视化)"
      - "code/apps/ainern2d-studio-api/app/api/v1/tasks.py (GET /runs/{run_id}/dag + DAG 可视化返回节点/边/状态)"
      - "code/apps/ainern2d-studio-api/app/api/v1/tasks.py (POST /runs/{run_id}/rerun-stage + 阶段级重跑请求 + TG 通知)"
    next_action: []

  - skill_id: "SKILL_29"
    name: "Asset Library by Project"
    status: "INTEGRATION_READY"
    gate: "PASS"
    spec: "SKILL_29_ASSET_LIBRARY_BY_PROJECT.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/assets.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/assets.py (project asset listing + keyword/anchored filter + delete + anchor mark/list + asset-binding consistency aggregate API)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/pages/StudioAssetLibraryPage.vue (素材库独立页面：列表/过滤/删除/anchor)"
      - "code/apps/ainern2d-studio-web/src/pages/StudioAssetBindingConsistencyPage.vue (人物/场景/道具绑定一致性独立页面：预览+锁定编辑+重生成)"
    next_action:
      - "资产血缘关系图与跨 run 复用推荐"

  - skill_id: "SKILL_30"
    name: "Timeline Editor / NLE"
    status: "INTEGRATION_READY"
    gate: "PASS"
    spec: "SKILL_30_TIMELINE_EDITOR_NLE.md"
    service: "code/apps/ainern2d-studio-api/app/api/v1/timesline.py"
    dispatch_binding:
      type: "studio_api"
      path: "code/apps/ainern2d-studio-api/app/main.py"
    evidence:
      - "code/apps/ainern2d-studio-api/app/api/v1/timesline.py (06/09/10/20 多轨读取 + /timeline/patch -> rerun-shot + /timeline/patches 历史 + rollback)"
      - "code/apps/ainern2d-studio-api/app/api/v1/timesline.py + app/services/telegram_notify.py (/timeline/patch 提交后触发 job.created 通知)"
      - "pytest code/apps/ainern2d-studio-api/tests/skills/test_skills_23_30_product_layer.py -q -> 2 passed"
      - "code/apps/ainern2d-studio-web/src/pages/StudioTimelinePatchPage.vue + src/api/product.ts (PR式时间线页面独立展示 + 多轨拖拽编辑 + patch 历史与回滚入口)"
    next_action:
      - "NLE 级增强：吸附/裁切/分组与更细粒度回滚对比"
