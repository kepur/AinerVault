# 14. ainer-studio-web — 前端工作台

## 1. 名词定位

**AinerN2D Studio Web** — 基于 Vue 3 的单页应用 (SPA)，是用户与系统交互的唯一入口。

## 2. 职责

| 功能域 | 说明 |
|---|---|
| Task 管理 | 创建 / 查看 / 取消 Task，展示 Run 列表与状态 |
| 流程进度 | 实时展示 Run 各 Stage（ingest→observe）进度与日志 |
| 时间线编辑 | 可视化编辑视频/音频轨道，拖拽调整镜头顺序与时长 |
| 分镜预览 | Shot 级别预览、重生成入口、A/B 对比 |
| 人工干预 | 手动跳过/重试/回退 Stage，修改 Entity 属性 |
| 资源面板 | 角色/场景/道具/音轨资产浏览与管理 |

## 3. 技术栈

| 层 | 技术选型 |
|---|---|
| 框架 | Vue 3 + TypeScript + Vite |
| 状态管理 | Pinia |
| UI 组件 | Element Plus / 自定义组件 |
| 路由 | Vue Router 4 |
| HTTP 客户端 | Axios (拦截器注入 tenant_id / trace_id) |
| 实时通信 | SSE (`/api/v1/runs/{run_id}/events`) |
| 国际化 | vue-i18n (zh-CN / en-US) |

## 4. 页面路由结构

```
/                          → Dashboard (项目列表)
/projects/:pid             → 项目详情
/projects/:pid/tasks       → Task 列表
/projects/:pid/runs/:rid   → Run 详情 + 进度看板
/projects/:pid/timeline    → 时间线编辑器
/projects/:pid/entities    → Entity 管理 (角色/场景/道具)
/projects/:pid/assets      → 资产库浏览
/projects/:pid/settings    → 项目设置 (质量/语言/策略)
```

## 5. 状态管理 (Pinia Stores)

| Store | 职责 |
|---|---|
| `useAuthStore` | JWT token 管理、登录/登出 |
| `useProjectStore` | 当前项目上下文、项目列表 |
| `useRunStore` | Run/Job 状态、SSE 实时更新 |
| `useTimelineStore` | 时间线轨道数据、编辑操作 |
| `useEntityStore` | Entity CRUD、关系图 |
| `useAssetStore` | 资产搜索、缓存 |

## 6. 实时通信契约

前端通过 **SSE** 接收 Run 状态推送：

```
GET /api/v1/runs/{run_id}/events
Accept: text/event-stream

# 服务端推送格式:
event: run.stage.changed
data: {"run_id":"xxx","stage":"execute","progress":45.0}

event: job.succeeded
data: {"job_id":"xxx","artifact_uri":"s3://..."}
```

## 7. API 调用约束

- 所有请求 Header 必须携带: `X-Tenant-Id`, `X-Project-Id`, `X-Trace-Id`
- 创建类接口额外携带: `X-Idempotency-Key`
- 错误响应统一解析 `AinerErrorResponse` 结构
- 文件上传使用 `multipart/form-data`，大文件走 MinIO presigned URL

## 8. 模块边界

| 边界 | 说明 |
|---|---|
| 仅与 studio-api 通信 | 不直接调用 worker-hub / composer / worker-runtime |
| 不含业务逻辑 | 所有编排/调度/生成逻辑在后端完成 |
| 不做持久化 | 所有数据通过 API 读写，前端仅缓存 |
| Stage 枚举同步 | 前端使用的 Stage 值必须与 `RenderStage` enum 完全一致 |