# 02. ainer-orchestrator

## 定位
工作流编排引擎（状态机 + DAG 权威层）。

## 核心职责
- 管理 `run/job/stage/event` 生命周期。
- 状态推进：以 `code/docs/architecture/stage-enum-authority.md` 为唯一权威。
- 失败恢复：重试、超时、取消、补偿。
- 统一写入编排事件，驱动下游执行。

## 输入
- `task.submitted`（来自 Gateway）。
- Worker 回写事件与 Composer 完成事件。

## 输出
- `run.created`、`run.stage.changed`、`job.created`、`run.failed`。

## 上下游
- 上游：`01.ainer-gateway.md`。
- 下游：`05.ainer-planner.md`、`06.ainer-model-router.md`、`07.ainer-worker-hub.md`、`12.ainer-composer.md`。

## 权威边界
- `run` 与 `job` 状态唯一真源。
- 其他模块不得直接改写编排状态终态。
- 仅 Orchestrator 可发布 `run.stage.changed`。

## 失败与回滚
- stage 内部失败：局部重试。
- stage 跨边界失败：补偿或降级（与 `18` 策略联动）。

## 不负责
- 不做实体抽取、提示词生成、素材匹配具体算法。